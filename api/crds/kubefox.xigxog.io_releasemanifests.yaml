# Copyright 2023 XigXog
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at https://mozilla.org/MPL/2.0/.
#
# SPDX-License-Identifier: MPL-2.0

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.13.0
  name: releasemanifests.kubefox.xigxog.io
spec:
  group: kubefox.xigxog.io
  names:
    kind: ReleaseManifest
    listKind: ReleaseManifestList
    plural: releasemanifests
    shortNames:
    - manifest
    - rm
    singular: releasemanifest
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.id
      name: Id
      type: string
    - jsonPath: .spec.virtualEnvironment.name
      name: Environment
      type: string
    - jsonPath: .spec.virtualEnvironment.environment
      name: VirtualEnvironment
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          data:
            description: Data is the merged values of the Environment and VirtualEnvironment
              data objects.
            properties:
              secrets:
                type: object
                x-kubernetes-preserve-unknown-fields: true
              vars:
                type: object
                x-kubernetes-preserve-unknown-fields: true
            type: object
          details:
            properties:
              description:
                type: string
              secrets:
                additionalProperties:
                  properties:
                    description:
                      type: string
                    title:
                      type: string
                  type: object
                type: object
              title:
                type: string
              vars:
                additionalProperties:
                  properties:
                    description:
                      type: string
                    title:
                      type: string
                  type: object
                type: object
            type: object
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            properties:
              apps:
                additionalProperties:
                  properties:
                    appDeployment:
                      properties:
                        name:
                          minLength: 1
                          type: string
                        resourceVersion:
                          minLength: 1
                          type: string
                        spec:
                          description: AppDeploymentSpec defines the desired state
                            of AppDeployment
                          properties:
                            adapters:
                              description: Specs of all Adapters defined as dependencies
                                by the Components. This a read-only field and is set
                                by the KubeFox Operator when a versioned AppDeployment
                                is created.
                              properties:
                                http:
                                  additionalProperties:
                                    properties:
                                      followRedirects:
                                        default: Never
                                        enum:
                                        - Never
                                        - Always
                                        - SameHost
                                        type: string
                                      headers:
                                        additionalProperties:
                                          type: string
                                        type: object
                                      insecureSkipVerify:
                                        default: false
                                        description: InsecureSkipVerify controls whether
                                          the Adapter verifies the server's certificate
                                          chain and host name. If InsecureSkipVerify
                                          is true, any certificate presented by the
                                          server and any host name in that certificate
                                          is accepted. In this mode, TLS is susceptible
                                          to machine-in-the-middle attacks.
                                        type: boolean
                                      url:
                                        format: uri
                                        type: string
                                    required:
                                    - url
                                    type: object
                                  type: object
                              required:
                              - http
                              type: object
                            appName:
                              type: string
                            branch:
                              type: string
                            commit:
                              pattern: ^[a-z0-9]{40}$
                              type: string
                            commitTime:
                              format: date-time
                              type: string
                            components:
                              additionalProperties:
                                properties:
                                  commit:
                                    pattern: ^[a-z0-9]{40}$
                                    type: string
                                  defaultHandler:
                                    type: boolean
                                  dependencies:
                                    additionalProperties:
                                      properties:
                                        type:
                                          enum:
                                          - DBAdapter
                                          - KubeFox
                                          - HTTPAdapter
                                          type: string
                                      required:
                                      - type
                                      type: object
                                    type: object
                                  envVarSchema:
                                    additionalProperties:
                                      properties:
                                        required:
                                          default: false
                                          type: boolean
                                        type:
                                          enum:
                                          - Array
                                          - Boolean
                                          - Number
                                          - String
                                          type: string
                                      required:
                                      - required
                                      type: object
                                    type: object
                                  image:
                                    type: string
                                  routes:
                                    items:
                                      properties:
                                        envVarSchema:
                                          additionalProperties:
                                            properties:
                                              required:
                                                default: false
                                                type: boolean
                                              type:
                                                enum:
                                                - Array
                                                - Boolean
                                                - Number
                                                - String
                                                type: string
                                            required:
                                            - required
                                            type: object
                                          type: object
                                        id:
                                          type: integer
                                        priority:
                                          type: integer
                                        rule:
                                          type: string
                                      required:
                                      - id
                                      - rule
                                      type: object
                                    type: array
                                  type:
                                    enum:
                                    - DBAdapter
                                    - KubeFox
                                    - HTTPAdapter
                                    type: string
                                required:
                                - commit
                                - type
                                type: object
                              minProperties: 1
                              type: object
                            containerRegistry:
                              type: string
                            imagePullSecretName:
                              type: string
                            repoURL:
                              type: string
                            tag:
                              type: string
                            version:
                              description: Version of the defined App. Use of semantic
                                versioning is recommended. Once set the AppDeployment
                                spec becomes immutable.
                              type: string
                          required:
                          - appName
                          - commit
                          - commitTime
                          - components
                          type: object
                        uid:
                          description: UID is a type that holds unique ID values,
                            including UUIDs.  Because we don't ONLY use UUIDs, this
                            is an alias to string.  Being a type captures intent and
                            helps make sure that UIDs and names do not get conflated.
                          type: string
                      required:
                      - name
                      - resourceVersion
                      - spec
                      - uid
                      type: object
                    version:
                      minLength: 1
                      type: string
                  required:
                  - appDeployment
                  - version
                  type: object
                minProperties: 1
                type: object
              id:
                minLength: 1
                type: string
              virtualEnvironment:
                properties:
                  environment:
                    minLength: 1
                    type: string
                  name:
                    minLength: 1
                    type: string
                  resourceVersion:
                    minLength: 1
                    type: string
                  uid:
                    description: UID is a type that holds unique ID values, including
                      UUIDs.  Because we don't ONLY use UUIDs, this is an alias to
                      string.  Being a type captures intent and helps make sure that
                      UIDs and names do not get conflated.
                    type: string
                required:
                - environment
                - name
                - resourceVersion
                - uid
                type: object
            required:
            - apps
            - id
            - virtualEnvironment
            type: object
        required:
        - data
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
